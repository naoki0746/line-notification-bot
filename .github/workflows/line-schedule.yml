# ----------------------------------------
# LINE通知を送る GitHub Actions Workflow
# 目的：毎日1回、朝9時（日本時間）に実行する
# ----------------------------------------

name: line-notification

on:
  # 手動実行（Actions画面から Run workflow できる）
  workflow_dispatch: {}

  # main ブランチに push されたときも実行（動作確認用）
  push:
    branches: ["main"]

  # 定期実行（cron）
  # GitHub Actions の cron は UTC 基準
  # 日本時間(JST) 9:00 = UTC 0:00
  schedule:
    - cron: "0 0 * * *"

# ----------------------------------------
# 同時実行制御
# 同じ workflow が重なったら前の実行をキャンセルする
# （cron のズレ対策・二重送信防止）
# ----------------------------------------
concurrency:
  group: line-notification
  cancel-in-progress: true

jobs:
  run:
    # GitHub が用意してくれる Ubuntu 環境で実行
    runs-on: ubuntu-latest

    steps:
      # リポジトリのコードを取得
      - name: Checkout
        uses: actions/checkout@v4

      # Python 3.10 をセットアップ
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # Pythonライブラリをインストール
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # メイン処理（LINE通知を送信）
      - name: Run script
        env:
          # GitHub Secrets に登録した値を環境変数として渡す
          LINE_CHANNEL_ACCESS_TOKEN: ${{ secrets.LINE_CHANNEL_ACCESS_TOKEN }}
          LINE_TO: ${{ secrets.LINE_TO }}
        run: |
          python main.py
